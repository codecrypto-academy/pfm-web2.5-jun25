# Besu Network API

REST API para gestionar redes Besu blockchain usando Next.js y TypeScript.

## CaracterÃ­sticas

- ğŸš€ **Next.js 14** con TypeScript
- ğŸ³ **GestiÃ³n de redes Docker** usando devisrael-docker-manager
- â›“ï¸ **Despliegue de redes Besu** blockchain
- ğŸ” **ValidaciÃ³n de datos** con Zod
- ğŸ“Š **Monitoreo de nodos** y logs
- ğŸ› ï¸ **API REST completa** para CRUD de redes

## InstalaciÃ³n

```bash
# Clonar el repositorio
git clone <repository-url>
cd besu-network-api

# Instalar dependencias
npm install

# Ejecutar en modo desarrollo
npm run dev
```

## Endpoints de la API

### Health Check
- **GET** `/api/health` - Verificar estado de la API

### GestiÃ³n de Redes

#### Crear Red
- **POST** `/api/networks`
```json
{
  "networkName": "mi-red-besu",
  "subnet": "172.25.0.0/16",
  "dataPath": "./besu-networks",
  "nodes": [
    {
      "name": "bootnode",
      "ip": "172.25.0.10",
      "isBootnode": true
    },
    {
      "name": "rpc-node",
      "ip": "172.25.0.11",
      "isRpc": true
    },
    {
      "name": "miner-node",
      "ip": "172.25.0.12",
      "isMiner": true
    }
  ]
}
```

#### Listar Redes
- **GET** `/api/networks`

#### Obtener InformaciÃ³n de Red
- **GET** `/api/networks/{networkName}`

#### Eliminar Red
- **DELETE** `/api/networks/{networkName}`

### GestiÃ³n de Nodos

#### Agregar Nodo (PrÃ³ximamente)
- **POST** `/api/networks/{networkName}/nodes`
```json
{
  "node": {
    "name": "validator-1",
    "ip": "172.25.0.13",
    "isMiner": true
  }
}
```

#### Remover Nodo
- **DELETE** `/api/networks/{networkName}/nodes`
```json
{
  "nodeName": "validator-1"
}
```

#### Obtener Logs de Nodo
- **GET** `/api/networks/{networkName}/nodes/{nodeName}/logs`

## Ejemplos de Uso

### 1. Crear una red Besu

```bash
curl -X POST http://localhost:3000/api/networks \
  -H "Content-Type: application/json" \
  -d '{
    "networkName": "test-network",
    "subnet": "172.25.0.0/16",
    "nodes": [
      {
        "name": "bootnode",
        "ip": "172.25.0.10",
        "isBootnode": true
      },
      {
        "name": "rpc-node",
        "ip": "172.25.0.11",
        "isRpc": true
      },
      {
        "name": "miner-node",
        "ip": "172.25.0.12",
        "isMiner": true
      }
    ]
  }'
```

### 2. Obtener informaciÃ³n de la red

```bash
curl http://localhost:3000/api/networks/test-network
```

### 3. Listar todas las redes

```bash
curl http://localhost:3000/api/networks
```

### 4. Obtener logs de un nodo

```bash
curl http://localhost:3000/api/networks/test-network/nodes/bootnode/logs
```

### 5. Remover un nodo

```bash
curl -X DELETE http://localhost:3000/api/networks/test-network/nodes \
  -H "Content-Type: application/json" \
  -d '{"nodeName": "miner-node"}'
```

### 6. Eliminar la red completa

```bash
curl -X DELETE http://localhost:3000/api/networks/test-network
```

## Respuestas de la API

Todas las respuestas siguen el siguiente formato:

### Respuesta Exitosa
```json
{
  "success": true,
  "message": "OperaciÃ³n completada exitosamente",
  "data": {
    // datos especÃ­ficos de la respuesta
  }
}
```

### Respuesta de Error
```json
{
  "success": false,
  "error": "DescripciÃ³n del error"
}
```

## Estructura del Proyecto

```
src/
â”œâ”€â”€ app/
â”‚   â””â”€â”€ api/
â”‚       â”œâ”€â”€ health/
â”‚       â”‚   â””â”€â”€ route.ts
â”‚       â””â”€â”€ networks/
â”‚           â”œâ”€â”€ route.ts
â”‚           â””â”€â”€ [networkName]/
â”‚               â”œâ”€â”€ route.ts
â”‚               â””â”€â”€ nodes/
â”‚                   â”œâ”€â”€ route.ts
â”‚                   â””â”€â”€ [nodeName]/
â”‚                       â””â”€â”€ logs/
â”‚                           â””â”€â”€ route.ts
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ network-manager.ts
â”‚   â””â”€â”€ validation.ts
â””â”€â”€ types/
    â””â”€â”€ api.ts
```

## ConfiguraciÃ³n de Desarrollo

### Variables de Entorno

Crea un archivo `.env.local`:

```env
# Puerto del servidor (opcional, por defecto 3000)
PORT=3000

# Directorio base para datos de Besu
BESU_DATA_PATH=./besu-networks
```

### Docker

AsegÃºrate de que Docker estÃ© corriendo:

```bash
# Verificar que Docker estÃ© corriendo
docker --version
docker ps

# Si no estÃ¡ corriendo, iniciarlo
sudo systemctl start docker  # Linux
# o usar Docker Desktop en Windows/Mac
```

## Scripts Disponibles

```bash
# Desarrollo
npm run dev

# ConstrucciÃ³n
npm run build

# ProducciÃ³n
npm start

# Linting
npm run lint

# Type checking
npm run type-check
```

## Dependencias Principales

- **Next.js 14**: Framework React para el backend API
- **TypeScript**: Tipado estÃ¡tico
- **devisrael-docker-manager**: Tu librerÃ­a para gestiÃ³n Docker y Besu
- **Zod**: ValidaciÃ³n de esquemas
- **dockerode**: InteracciÃ³n con Docker API

## Limitaciones Actuales

1. **Agregar nodos dinÃ¡micamente**: Actualmente solo se pueden agregar nodos al crear la red completa
2. **Persistencia**: Los datos de redes activas se mantienen solo en memoria
3. **AutenticaciÃ³n**: No implementada (para desarrollo)
4. **Rate limiting**: No implementado

## PrÃ³ximas Mejoras

- [ ] Implementar agregado dinÃ¡mico de nodos
- [ ] Persistencia de datos en base de datos
- [ ] AutenticaciÃ³n y autorizaciÃ³n
- [ ] Rate limiting
- [ ] Websockets para estado en tiempo real
- [ ] MÃ©tricas y monitoreo avanzado
- [ ] Interfaz web para gestiÃ³n visual

## Desarrollo y Testing

### Testing Manual

1. Ejecutar la API:
```bash
npm run dev
```

2. Usar herramientas como Postman, Insomnia o curl para probar los endpoints

3. Verificar logs de contenedores Docker:
```bash
docker logs <container-name>
```

### Debugging

- Los logs de la aplicaciÃ³n aparecen en la consola de Next.js
- Los logs de contenedores Besu estÃ¡n disponibles via el endpoint `/logs`
- Usar Docker Desktop para monitoreo visual de contenedores

## Deployment

### Desarrollo Local
```bash
npm run dev
```

### ProducciÃ³n
```bash
npm run build
npm start
```

### Docker (Opcional)
```dockerfile
# Dockerfile para la API
FROM node:18-alpine

WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

COPY . .
RUN npm run build

EXPOSE 3000
CMD ["npm", "start"]
```

## Troubleshooting

### Error: "Cannot connect to Docker daemon"
- Verificar que Docker estÃ© corriendo
- Verificar permisos de usuario para Docker

### Error: "Port already in use"
- Cambiar el puerto en `.env.local`
- Verificar que no hay otras aplicaciones usando el puerto

### Error: "Network already exists"
- Eliminar la red existente primero
- Verificar con `docker network ls`

## ContribuciÃ³n

1. Fork el proyecto
2. Crear branch para feature (`git checkout -b feature/amazing-feature`)
3. Commit cambios (`git commit -m 'Add amazing feature'`)
4. Push al branch (`git push origin feature/amazing-feature`)
5. Abrir Pull Request

## Licencia

ISC

## Autor

@devisrael